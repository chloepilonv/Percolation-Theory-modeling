<html>
<head>
<title>COVID19_0502.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #808080;}
.s3 { color: #6897bb;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
COVID19_0502.py</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s1">numpy </span><span class="s0">as </span><span class="s1">np</span>
<span class="s0">import </span><span class="s1">matplotlib.pyplot </span><span class="s0">as </span><span class="s1">plt</span>
<span class="s0">import </span><span class="s1">time</span>
<span class="s0">import </span><span class="s1">csv</span>

<span class="s1">t0 = time.time()</span>

<span class="s2">#Creation grille n*n</span>
<span class="s1">n = </span><span class="s3">50</span>
<span class="s1">it = </span><span class="s3">10</span>

<span class="s2">#grille principale</span>
<span class="s1">grille = np.zeros(n**</span><span class="s3">2</span><span class="s1">).reshape(n</span><span class="s0">, </span><span class="s1">n)</span>
<span class="s1">plt.imshow(grille)</span>

<span class="s2">#grille de comptage</span>
<span class="s1">grille2 = np.zeros(n**</span><span class="s3">2</span><span class="s1">).reshape(n</span><span class="s0">, </span><span class="s1">n)</span>

<span class="s2">#Activation de x pts infectés</span>
<span class="s1">x = </span><span class="s3">10</span>
<span class="s1">coord_x = np.ones(x</span><span class="s0">, </span><span class="s1">dtype=int)</span>
<span class="s1">coord_y = np.ones(x</span><span class="s0">, </span><span class="s1">dtype=int)</span>
<span class="s1">i = </span><span class="s3">0</span>
<span class="s0">while </span><span class="s1">i&lt;x:</span>
    <span class="s1">coord_x[i] = int(round(np.random.random()*n-</span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">coord_y[i] = int(round(np.random.random()*n-</span><span class="s3">1</span><span class="s1">))</span>
    <span class="s1">i += </span><span class="s3">1</span>

<span class="s1">i = </span><span class="s3">0</span>
<span class="s0">while </span><span class="s1">i&lt;x:</span>
    <span class="s1">grille[coord_x[i]</span><span class="s0">, </span><span class="s1">coord_y[i]] = </span><span class="s3">1</span>
    <span class="s1">i += </span><span class="s3">1</span>

<span class="s2">#Iterations de contamination</span>
<span class="s1">b = </span><span class="s3">0.190 </span><span class="s2">#taux d'infection</span>
<span class="s1">k = </span><span class="s3">0.035 </span><span class="s2">#taux de retablissement (apres le temps de retablissement)</span>
<span class="s1">m = </span><span class="s3">0.02 </span><span class="s2">#taux de personnes decedees</span>
<span class="s1">v = </span><span class="s3">0.01 </span><span class="s2">#taux de vaccination</span>
<span class="s1">t = </span><span class="s3">15 </span><span class="s2">#temps avant le debut de la vaccination</span>
<span class="s1">R0=</span><span class="s3">4 </span><span class="s2">#taux de reproduction de base</span>
<span class="s1">duree_infection = </span><span class="s3">14</span>
<span class="s1">duree_immunisation = </span><span class="s3">70</span>
<span class="s1">duree_vaccin = </span><span class="s3">180</span>
<span class="s1">efficacite_vaccin_initiale = </span><span class="s3">0.9</span>
<span class="s1">perte_efficacite = </span><span class="s3">0.1</span>

<span class="s2"># nombre de voisins affectés par la contamination</span>
<span class="s1">voisins = </span><span class="s3">3 </span><span class="s2"># il faut modifier le code dans les iterations pour modifier le nombre de voisins</span>

<span class="s1">save = </span><span class="s3">10</span>
<span class="s1">s = save</span>

<span class="s1">f = </span><span class="s3">0</span>
<span class="s1">plt.imshow(grille</span><span class="s0">, </span><span class="s1">cmap = </span><span class="s4">'jet'</span><span class="s1">)</span>
<span class="s1">plt.colorbar()</span>

<span class="s2"># Variables pour graphique SIR</span>
<span class="s1">sain = np.zeros(it)</span>
<span class="s1">infecte = np.zeros(it)</span>
<span class="s1">retabli = np.zeros(it)</span>
<span class="s1">decede = np.zeros(it)</span>
<span class="s1">vaccine = np.zeros(it)</span>

<span class="s2"># Taux de reproduction de base</span>
<span class="s1">reprod1=np.zeros(it)</span>
<span class="s1">reprod2=np.zeros(it)</span>
<span class="s1">reprodv=np.zeros(it)</span>
<span class="s1">reprod1[</span><span class="s3">0</span><span class="s1">] = R0</span>
<span class="s1">reprod2[</span><span class="s3">0</span><span class="s1">] = R0</span>
<span class="s1">reprodv[</span><span class="s3">0</span><span class="s1">] = R0</span>

<span class="s0">while </span><span class="s1">f&lt;it:</span>

    <span class="s2">#nombre de voisins a considerer pour l'infection</span>
    <span class="s0">if </span><span class="s1">f &gt;= </span><span class="s3">100</span><span class="s1">:</span>
        <span class="s1">voisins = </span><span class="s3">2</span>
    <span class="s0">if </span><span class="s1">f &gt;= </span><span class="s3">200</span><span class="s1">:</span>
        <span class="s1">voisins = </span><span class="s3">1</span>

    <span class="s2">#Contamination aleatoire de personnes (proportionnel au nb d'infecte)</span>
    <span class="s1">cont_rand = round(infecte[f-</span><span class="s3">1</span><span class="s1">]/</span><span class="s3">100</span><span class="s1">*voisins)</span>
    <span class="s1">p = </span><span class="s3">0</span>
    <span class="s0">while </span><span class="s1">p &lt; cont_rand:</span>
        <span class="s1">x = int(round(np.random.random() * n - </span><span class="s3">1</span><span class="s1">))</span>
        <span class="s1">y = int(round(np.random.random() * n - </span><span class="s3">1</span><span class="s1">))</span>
        <span class="s0">if </span><span class="s1">grille[x</span><span class="s0">, </span><span class="s1">y] == </span><span class="s3">0</span><span class="s1">:</span>
            <span class="s1">grille[x</span><span class="s0">, </span><span class="s1">y] = </span><span class="s3">1</span>

        <span class="s1">p += </span><span class="s3">1</span>

    <span class="s1">print(</span><span class="s4">&quot;Iteration:&quot;</span><span class="s0">, </span><span class="s1">f)</span>
    <span class="s1">points_a_infecter = np.ones(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">dtype=int)</span>
    <span class="s1">points_a_retablir = np.ones(</span><span class="s3">1</span><span class="s0">, </span><span class="s1">dtype=int)</span>

    <span class="s2"># compilation des etats de la grille (pour graphique final) et infections</span>
    <span class="s1">i = </span><span class="s3">0</span>
    <span class="s0">while </span><span class="s1">i&lt; n:</span>
        <span class="s1">j = </span><span class="s3">0</span>
        <span class="s0">while </span><span class="s1">j&lt;n:</span>
            <span class="s0">if </span><span class="s1">f &gt;= t:</span>
                <span class="s2">#points vaccines</span>
                <span class="s1">r = np.random.random()</span>
                <span class="s0">if </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0 </span><span class="s0">or </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0.5 </span><span class="s0">and </span><span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j]&lt;=</span><span class="s3">0</span><span class="s1">:</span>
                    <span class="s1">r2 = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">r &lt; v:</span>
                        <span class="s0">if </span><span class="s1">r2 &lt; efficacite_vaccin_initiale:</span>
                            <span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0.75</span>
                            <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] = -</span><span class="s3">1</span>

                <span class="s0">if </span><span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] &lt;= -duree_vaccin </span><span class="s0">and </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0.75</span><span class="s1">:</span>
                    <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0</span>
                    <span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0</span>

                <span class="s0">if </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0.75</span><span class="s1">:</span>
                    <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] -= </span><span class="s3">1</span>
                    <span class="s1">vaccine[f] += </span><span class="s3">1</span>
                    <span class="s1">r2 = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">r2 &lt; perte_efficacite:</span>
                        <span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0</span>
                        <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0</span>

            <span class="s2">#points infectes</span>
            <span class="s0">if </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">1</span><span class="s1">:</span>

                <span class="s1">infecte[f] += </span><span class="s3">1</span>

                <span class="s2">#infection selon le nombre de voisins</span>

                <span class="s2"># juste premiers plus proches voisins</span>
                <span class="s0">if </span><span class="s1">voisins == </span><span class="s3">1</span><span class="s1">:</span>
                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i+</span><span class="s3">1 </span><span class="s1">&lt;n: </span><span class="s2">#conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i-</span><span class="s3">1</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">: </span><span class="s2">#conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i - </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j+</span><span class="s3">1</span><span class="s1">&lt;n: </span><span class="s2">#conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j-</span><span class="s3">1</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">: </span><span class="s2">#conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">)</span>

                <span class="s2">#deuxiemes et premiers plus proches voisins</span>
                <span class="s0">if </span><span class="s1">voisins == </span><span class="s3">2</span><span class="s1">:</span>
                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i + </span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i - </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j + </span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i + </span><span class="s3">1 </span><span class="s1">&lt; n </span><span class="s0">and </span><span class="s1">j + </span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j+</span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j+</span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0 </span><span class="s0">and </span><span class="s1">j-</span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j-</span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i - </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j-</span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j + </span><span class="s3">1 </span><span class="s1">&lt; n </span><span class="s0">and </span><span class="s1">i-</span><span class="s3">1</span><span class="s1">&gt;=</span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i-</span><span class="s3">1</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i-</span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0 </span><span class="s0">and </span><span class="s1">i+</span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i+</span><span class="s3">1</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i+</span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">)</span>

                <span class="s2">#1er, 2e et 3e plus proches voisins</span>
                <span class="s0">if </span><span class="s1">voisins == </span><span class="s3">3</span><span class="s1">:</span>
                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i + </span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i - </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j + </span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i + </span><span class="s3">1 </span><span class="s1">&lt; n </span><span class="s0">and </span><span class="s1">j + </span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0 </span><span class="s0">and </span><span class="s1">j - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i - </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j + </span><span class="s3">1 </span><span class="s1">&lt; n </span><span class="s0">and </span><span class="s1">i - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i - </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i - </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j - </span><span class="s3">1 </span><span class="s1">&gt;= </span><span class="s3">0 </span><span class="s0">and </span><span class="s1">i + </span><span class="s3">1 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i + </span><span class="s3">1</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i + </span><span class="s3">1</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">1</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i + </span><span class="s3">2 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i + </span><span class="s3">2</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i + </span><span class="s3">2</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">i - </span><span class="s3">2 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i - </span><span class="s3">2</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i - </span><span class="s3">2</span><span class="s1">)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j + </span><span class="s3">2 </span><span class="s1">&lt; n:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">2</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j + </span><span class="s3">2</span><span class="s1">)</span>

                    <span class="s1">r = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">j - </span><span class="s3">2 </span><span class="s1">&gt;= </span><span class="s3">0</span><span class="s1">:  </span><span class="s2"># conditions frontiere de la grille</span>
                        <span class="s0">if </span><span class="s1">(grille[i</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">2</span><span class="s1">] == </span><span class="s3">0</span><span class="s1">) </span><span class="s0">and </span><span class="s1">b &gt; r:</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">i)</span>
                            <span class="s1">points_a_infecter = np.append(points_a_infecter</span><span class="s0">, </span><span class="s1">j - </span><span class="s3">2</span><span class="s1">)</span>


                <span class="s2">#Conditions de retablissement (min 14 jours)</span>
                <span class="s0">if </span><span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] &lt; duree_infection:</span>
                    <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] += </span><span class="s3">1</span>
                <span class="s2">#Ajout des ppoints a la liste de points a retablir</span>
                <span class="s0">if </span><span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] &gt;= duree_infection:</span>
                    <span class="s1">r = np.random.random()</span>
                    <span class="s1">r2 = np.random.random()</span>
                    <span class="s0">if </span><span class="s1">r &lt; k:</span>
                        <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] = -</span><span class="s3">1</span>
                        <span class="s1">points_a_retablir = np.append(points_a_retablir</span><span class="s0">, </span><span class="s1">i)</span>
                        <span class="s1">points_a_retablir = np.append(points_a_retablir</span><span class="s0">, </span><span class="s1">j)</span>
                    <span class="s0">else</span><span class="s1">: </span><span class="s2">#Si le point ne se retablis pas il a une chance de mourir</span>
                        <span class="s0">if </span><span class="s1">r2 &lt; m:</span>
                            <span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0.25</span>


            <span class="s2">#points morts</span>
            <span class="s0">if </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0.25</span><span class="s1">:</span>
                <span class="s1">decede[f] += </span><span class="s3">1</span>

            <span class="s2">#points sains</span>
            <span class="s0">if </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0</span><span class="s1">:</span>
                <span class="s1">sain[f] += </span><span class="s3">1</span>

            <span class="s2">#points retablis</span>
            <span class="s0">if </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] == </span><span class="s3">0.5</span><span class="s1">:</span>
                <span class="s1">retabli[f] += </span><span class="s3">1</span>

                <span class="s2">#Conditions pour passer de retabli a sain</span>
                <span class="s0">if </span><span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] &gt; -duree_immunisation:</span>
                    <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] -= </span><span class="s3">1</span>

                <span class="s0">if </span><span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] &lt;= -duree_immunisation </span><span class="s0">and </span><span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] ==</span><span class="s3">0.5</span><span class="s1">:</span>
                    <span class="s1">grille2[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0</span>
                    <span class="s1">grille[i</span><span class="s0">, </span><span class="s1">j] = </span><span class="s3">0</span>

            <span class="s1">j = j+</span><span class="s3">1</span>
        <span class="s1">i = i+</span><span class="s3">1</span>


    <span class="s2">#boucle d'infection avec liste des points a infecter</span>
    <span class="s1">i = </span><span class="s3">1</span>
    <span class="s0">while </span><span class="s1">i&lt;len(points_a_infecter):</span>
        <span class="s1">grille[points_a_infecter[i]</span><span class="s0">, </span><span class="s1">points_a_infecter[i + </span><span class="s3">1</span><span class="s1">]] = </span><span class="s3">1</span>
        <span class="s1">i = i+</span><span class="s3">2</span>

    <span class="s2">#boucle de retablissement avec liste des points a retablir</span>
    <span class="s1">i = </span><span class="s3">1</span>
    <span class="s0">while </span><span class="s1">i &lt; len(points_a_retablir):</span>
        <span class="s1">grille[points_a_retablir[i]</span><span class="s0">, </span><span class="s1">points_a_retablir[i + </span><span class="s3">1</span><span class="s1">]] = </span><span class="s3">0.5</span>
        <span class="s1">i = i + </span><span class="s3">2</span>

    <span class="s1">plt.imshow(grille</span><span class="s0">, </span><span class="s1">cmap = </span><span class="s4">'jet'</span><span class="s1">)</span>
    <span class="s1">plt.pause(</span><span class="s3">0.05</span><span class="s1">)</span>
    <span class="s2">#if f == save:</span>
        <span class="s2">#savename = 'grilles/grille'+str(save)+'.png'</span>
        <span class="s2">#plt.savefig(savename)</span>
        <span class="s2">#save += s</span>

    <span class="s2">#boucle calcul du taux de reproduction</span>
    <span class="s0">if </span><span class="s1">f &gt;= </span><span class="s3">1</span><span class="s1">:</span>
            <span class="s2"># OPTION 1, NISHIURA</span>
            <span class="s1">reprod1[f] = R0 * sain[f] / sain[f-</span><span class="s3">1</span><span class="s1">]</span>

            <span class="s2"># OPTION 2, Cori, avec différents b</span>
            <span class="s1">reprod2[f] = b * (sain[f] / sain[</span><span class="s3">0</span><span class="s1">]) * duree_infection  </span><span class="s2"># ou / n**2</span>

            <span class="s1">reprodv[f] = R0  </span><span class="s2"># la vaccination na pas commence</span>

    <span class="s0">if </span><span class="s1">f &gt;= t:</span>
            <span class="s2"># OPTION UNIQUE, Calcul du taux de reproduction avec vaccin Rv(t)</span>
            <span class="s1">p = vaccine[f] / (n ** </span><span class="s3">2</span><span class="s1">)</span>
            <span class="s1">reprodv[f] = R0 * (</span><span class="s3">1 </span><span class="s1">- p)</span>
    <span class="s1">f += </span><span class="s3">1</span>

<span class="s1">t1 = time.time()</span>
<span class="s1">print(t1-t0)</span>
<span class="s1">print(</span><span class="s4">&quot;Simulation terminee&quot;</span><span class="s1">)</span>
<span class="s1">plt.show()</span>

<span class="s1">temps = np.arange(</span><span class="s3">0</span><span class="s0">, </span><span class="s1">it</span><span class="s0">, </span><span class="s3">1</span><span class="s1">)</span>
<span class="s1">plt.plot(temps</span><span class="s0">, </span><span class="s1">sain</span><span class="s0">, </span><span class="s1">label = </span><span class="s4">&quot;sain&quot;</span><span class="s1">)</span>
<span class="s1">plt.plot(temps</span><span class="s0">, </span><span class="s1">infecte</span><span class="s0">, </span><span class="s1">label = </span><span class="s4">&quot;infecte&quot;</span><span class="s1">)</span>
<span class="s1">plt.plot(temps</span><span class="s0">, </span><span class="s1">retabli</span><span class="s0">, </span><span class="s1">label =</span><span class="s4">&quot;retabli&quot;</span><span class="s1">)</span>
<span class="s1">plt.plot(temps</span><span class="s0">, </span><span class="s1">decede</span><span class="s0">, </span><span class="s1">label =</span><span class="s4">&quot;morts&quot;</span><span class="s1">)</span>
<span class="s1">plt.plot(temps</span><span class="s0">, </span><span class="s1">vaccine</span><span class="s0">, </span><span class="s1">label = </span><span class="s4">&quot;vaccine&quot;</span><span class="s1">)</span>
<span class="s1">plt.ylabel(</span><span class="s4">'Nombre d’individus'</span><span class="s1">)</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Itérations/Journées'</span><span class="s1">)</span>
<span class="s1">plt.title(</span><span class="s4">'Variation des états SIRDV dans le temps'</span><span class="s1">)</span>
<span class="s1">plt.legend()</span>
<span class="s1">plt.show()</span>

<span class="s2">#NOUVEAU</span>
<span class="s1">plt.plot(temps</span><span class="s0">,</span><span class="s1">reprod1</span><span class="s0">, </span><span class="s1">label = </span><span class="s4">&quot;Option 1&quot;</span><span class="s1">)</span>
<span class="s1">plt.plot(temps</span><span class="s0">, </span><span class="s1">reprod2</span><span class="s0">, </span><span class="s1">label = </span><span class="s4">&quot;Option 2, b=0.4&quot;</span><span class="s0">, </span><span class="s1">linestyle=</span><span class="s4">'dashed'</span><span class="s1">)</span>
<span class="s1">plt.plot(temps</span><span class="s0">, </span><span class="s1">reprodv</span><span class="s0">, </span><span class="s1">label = </span><span class="s4">&quot;Apres vaccination&quot;</span><span class="s1">)</span>
<span class="s1">plt.title(</span><span class="s4">'Variation du taux de reproduction instantanée'</span><span class="s1">)</span>
<span class="s1">plt.xlabel(</span><span class="s4">'Temps (j)'</span><span class="s1">)</span>
<span class="s1">plt.ylabel(</span><span class="s4">'R(t)'</span><span class="s1">)</span>
<span class="s1">plt.legend()</span>
<span class="s1">plt.show()</span>

<span class="s0">with </span><span class="s1">open(</span><span class="s4">'data.csv'</span><span class="s0">, </span><span class="s1">mode = </span><span class="s4">'w'</span><span class="s1">) </span><span class="s0">as </span><span class="s1">csv_file:</span>
    <span class="s1">fieldnames = [</span><span class="s4">'S'</span><span class="s0">, </span><span class="s4">'I'</span><span class="s0">, </span><span class="s4">'R'</span><span class="s0">, </span><span class="s4">'D'</span><span class="s0">, </span><span class="s4">'V'</span><span class="s1">]</span>
    <span class="s1">writer = csv.DictWriter(csv_file</span><span class="s0">, </span><span class="s1">fieldnames=fieldnames)</span>

    <span class="s1">i = </span><span class="s3">0</span>
    <span class="s0">while </span><span class="s1">i &lt; len(temps):</span>
        <span class="s1">writer.writerow({</span><span class="s4">'S'</span><span class="s1">: sain[i]</span><span class="s0">, </span><span class="s4">'I'</span><span class="s1">: infecte[i]</span><span class="s0">, </span><span class="s4">'R'</span><span class="s1">: retabli[i]</span><span class="s0">, </span><span class="s4">'D'</span><span class="s1">: decede[i]</span><span class="s0">, </span><span class="s4">'V'</span><span class="s1">: vaccine[i]})</span>
        <span class="s1">i += </span><span class="s3">1</span>




</pre>
</body>
</html>